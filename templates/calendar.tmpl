{{define "content"}}
<div class="space-y-8">
    <div class="text-center">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Calendar</h1>
        <p class="text-gray-600">View your posting schedule and history</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Calendar Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Calendar View</h2>
                <button 
                    hx-get="/posts/calendar" 
                    hx-target="#calendar-grid"
                    class="text-blue-600 hover:text-blue-800 text-sm">
                    Refresh
                </button>
            </div>
            
            <div class="mb-4 flex justify-between items-center">
                <button 
                    id="prev-month"
                    hx-get="/posts/calendar" 
                    hx-target="#calendar-grid"
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    ← Previous
                </button>
                <h3 id="current-month" class="text-xl font-semibold">Loading...</h3>
                <button 
                    id="next-month"
                    hx-get="/posts/calendar" 
                    hx-target="#calendar-grid"
                    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    Next →
                </button>
            </div>
            
            <div id="calendar-grid" 
                 hx-get="/posts/calendar" 
                 hx-trigger="load"
                 hx-target="this">
                <div class="text-center text-gray-500">
                    <span class="htmx-indicator inline">Loading calendar...</span>
                </div>
            </div>
        </div>

        <!-- Posts History Section -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Post History</h2>
                <button 
                    hx-get="/posts/history" 
                    hx-target="#history-list"
                    class="text-blue-600 hover:text-blue-800 text-sm">
                    Refresh
                </button>
            </div>
            
            <div id="history-list" 
                 hx-get="/posts/history?limit=15" 
                 hx-trigger="load"
                 hx-target="this">
                <div class="text-center text-gray-500">
                    <span class="htmx-indicator inline">Loading history...</span>
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <button 
                    id="load-more"
                    hx-get="/posts/history?page=2&limit=15" 
                    hx-target="#history-list"
                    hx-swap="beforeend"
                    class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                    Load More
                </button>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Legend</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="flex items-center">
                <div class="w-4 h-4 bg-gray-200 border border-gray-300 mr-3"></div>
                <span class="text-sm text-gray-600">No posts</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-blue-100 border border-blue-500 mr-3"></div>
                <span class="text-sm text-gray-600">Has posts</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-green-100 border border-green-500 mr-3"></div>
                <span class="text-sm text-gray-600">Published posts</span>
            </div>
            <div class="flex items-center">
                <div class="w-4 h-4 bg-yellow-100 border border-yellow-500 mr-3"></div>
                <span class="text-sm text-gray-600">Scheduled posts</span>
            </div>
        </div>
    </div>
</div>

<script>
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth() + 1;

    function updateCalendarNav() {
        const prevMonth = currentMonth === 1 ? 12 : currentMonth - 1;
        const prevYear = currentMonth === 1 ? currentYear - 1 : currentYear;
        const nextMonth = currentMonth === 12 ? 1 : currentMonth + 1;
        const nextYear = currentMonth === 12 ? currentYear + 1 : currentYear;

        document.getElementById('prev-month').setAttribute('hx-get', 
            `/posts/calendar?year=${prevYear}&month=${prevMonth}`);
        document.getElementById('next-month').setAttribute('hx-get', 
            `/posts/calendar?year=${nextYear}&month=${nextMonth}`);
        
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"];
        document.getElementById('current-month').textContent = 
            `${monthNames[currentMonth - 1]} ${currentYear}`;
    }

    // Initialize calendar navigation
    updateCalendarNav();

    // Listen for calendar updates
    document.body.addEventListener('htmx:beforeRequest', function(evt) {
        if (evt.detail.target.id === 'calendar-grid') {
            const url = new URL(evt.detail.requestConfig.url, window.location.origin);
            const year = url.searchParams.get('year');
            const month = url.searchParams.get('month');
            if (year && month) {
                currentYear = parseInt(year);
                currentMonth = parseInt(month);
                updateCalendarNav();
            }
        }
    });

    // Load more posts pagination
    let currentPage = 1;
    document.getElementById('load-more').addEventListener('click', function() {
        currentPage++;
        this.setAttribute('hx-get', `/posts/history?page=${currentPage + 1}&limit=15`);
    });
</script>
{{end}}